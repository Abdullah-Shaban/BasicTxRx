iMinds
======

Requirements:

  * [Install Open VPN client](https://openvpn.net/index.php/open-source/downloads.html)
  * [Request an w-iLab.t testbed account](http://ilabt.iminds.be/gettingstarted)
  * [Basic knowledge of the w-iLab.t Zwijnaarde testbed](http://ilabt.iminds.be/node/93)
  * [Basic knowledge of using USRP in w-iLab.t Zwijnaarde testbed](http://doc.ilabt.iminds.be/ilabt-documentation/wilabfacility.html#using-the-usrp-devices)

Simple receiver example
-----------------------


The 'rx_application.ns' file describes the topology of the USRP and the host server on the testbed.
The 'rx_application.grc' file implements a simple QPSK receiver in GNU Radio Companion (GRC).
The 'rx_application.png' file contains a screenshot of the GRC flow graph.
The 'rx_application.py' file is the python file automatically generated by GRC.

To run the receiver:

    $ reserve 1 USRP and 1 server (can be both server1P or server5P) on the testbed reservation page
    $ define an emulab experiment using the rx_application.ns file (if it does not exist), adapt the USRP and server according to the reservation and swap in the experiment
    $ log into the reserved server with your w-iLab.t account graphically (with -X option if using ssh client)
    $ verify the connection between the server and USRP
    $ launch GRC by running the command: gnuradio-companion
    $ open the 'rx_application.grc' with GRC, adapt the IP address of the USRP 
    $ execute the flow graph with the "run" button 
    $ alternatively, the file sink can be enabled to take a look at the received data. 

This .grc file mainly consists of the following components:
  * USRP source
    * Provides raw samples from the USRP
  * FLL Band Edge
    * Implements frequency locked loop and band edge filters to correct the frequency offset
  * Correlate and Sync
    * The block searches for a preamble using correlation to get time and phase estimation
  * Poly phase clock sync
    * Performs clock correction using poly phase filter
  * Costas loop
    * Performs fine clock and phase adjustment and lock to a particular constellation  
  * Packet Decoder
    * Decode the symbols, remove preambles and headers, output payload bytes and number of packets received per second


Simple transmitter example
--------------------------

The 'tx_application.ns' file describes the topology of the USRP and the host server on the testbed.
The 'tx_application.grc' file implements a simple transmitter in GNU Radio Companion (GRC), which reads data from the source file and feed it to a packet generator (a hierachical block), users may vary the payload size and interpacket interval at run time. 
The 'tx_application.png' file contains the screenshot of the top level GRC flow chart.
The 'crew_packet_gen.grc' is the flow chart  of the hierachical block packet generator in GRC.
The 'crew_packet_gen.png' contains the screenshot of the packet generator's flow chart.
All python files are automatically generated by the GRC.


To run the transmitter:

    $ reserve 1 USRP and 1 server (can be both server1P or server5P) on the testbed reservation page
    $ define an emulab experiment using the tx_application.ns file (if it does not exist), adapt the USRP and server in the ns file according to the reservation, and swap in the experiment
    $ log onto the reserved server with your w-iLab.t account graphically (with -X option if using ssh client)
    $ verify the connection between the server and USRP
    $ launch GRC by running the command: gnuradio-companion
    $ open the 'crew_packet_gen.grc' with GRC and compile it with the 'compile' button, after which you should see the 'crew' category shows up in your GRC library
    $ open the 'tx_application.grc' with GRC, adapt the IP address of the USRP according to the reservation, double click on file source and select the 'file_sent.txt', execute the flow chart  with the "run" button 

This tx_application.grc file consists of five components:
  * File Source
    * Provides bits from a file
  * Packet Generator 
    * Fragments the bitstream by the payload size
    * Appends 32 bit CRC for the payload in each packet
    * Appends 32 bit header, among which 12 bit for payload length, 12 bit for sequence number and 8 bit for the CRC of the header (for details see GNURadio packet_header_default.h)  
    * Append a preamble of 64 bit
  * Multiply Const
    * Scales down the amplitude of the samples before transmitting to USRP, else DAC might be saturated
  * USRP sink
    * Sends the sample to USRP and transmits over the air
  * Frequency sink
    * Provides the spectrum view of the transmitted samples

References:
  * http://gnuradio.org/redmine/projects/gnuradio/repository/revisions/master/show/gr-digital/examples/
