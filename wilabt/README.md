iMinds
======

Requirements:

  * [Install Open VPN client](https://openvpn.net/index.php/open-source/downloads.html)
  * [Request an w-iLab.t testbed account](http://ilabt.iminds.be/gettingstarted)
  * [Basic knowledge of the w-iLab.t Zwijnaarde testbed](http://ilabt.iminds.be/node/93)
  * [Basic knowledge of using USRP in w-iLab.t Zwijnaarde testbed](http://doc.ilabt.iminds.be/ilabt-documentation/wilabfacility.html#using-the-usrp-devices)

Common steps:
-----------------------
Using the Old emulab appraoch:
The 'txrx_application.ns' file describes the topology of the USRPs and the host server on the testbed.
    $ reserve 2 USRP's and 1 server5P (5P means server with 5 eithernet ports ) at https://www.wilab2.ilabt.iminds.be/reservation/
    $ define an emulab experiment using the txrx_application.ns file (if it does not exist)
    $ adapt the USRP's and server in the script according to the reservation and swap in the experiment
Using the jFed interface:
    $ reserve 5 USRP's and 1 server5P at https://www.wilab2.ilabt.iminds.be:12369/reservation/sfareservation.php3
    $ load the experiment as defined by usrp.rspec file into jFed GUI
    $ adapt the experiment according to reservation and run the experiment
Common steps:
    $ log into the reserved server with your w-iLab.t account graphically (with -X option if using ssh client)
    $ verify the connection between the server and USRP using the 'uhd_usrp_probe' command
    $ launch gnuradio companion (GRC) on the server by running the command: gnuradio-companion

Simple transmitter example
--------------------------
The 'tx_application.grc' file implements a simple transmitter in GNU Radio Companion (GRC), which reads data from the source file and feed it to a packet generator (a hierachical block), users may vary the payload size and interpacket interval at run time. 
The 'tx_application.png' file contains the screenshot of the top level GRC flow chart.
All python files are automatically generated by the GRC.


To run the transmitter:
    $ open the 'tx_application.grc' with GRC
    $ adapt the IP address of the USRP according to the reservation
    $ double click on 'File Source' and browse to your git repository to select the 'file_sent.txt'
    $ execute the flow chart  with the "run" button 

This tx_application.grc file consists of the following components:
  * File Source
    * Provides bits from a file
  * Stream to Tagged Stream
    * Adds the tag "packet_len" according to the payload size
  * Stream CRC32
    * Generates 32 bit CRC for the payload 
  * Packet Header Generator (default)
    * Generates 32 bit header (12: payload length; 12: sequence number; 8: header CRC), for details see GNURadio packet_header_default.h
  * Pack 8 bits
    * Assembles the header bits into bytes 
  * Vector Source, Unpack 2 Bits, Pack 8 Bits
    * Maps the preamble symbols into bits and pack it into bytes
  * Stream Mux
    * Combine the preamble, header, payload together
  * Constellation Modulator
    * Maps bits into complex symbols according to the constellation
  * Multiply Const
    * Scale the complex samples down to avoid saturation the DAC
  * QT GUI Frequency Sink
    * A visualizer in frequency domain of the transmitted signal
  * UHD: USRP Sink
    * Sends the samples to USRP for actual tranmission 


Simple receiver example
-----------------------
The 'rx_application.grc' file implements a simple QPSK receiver in GNU Radio Companion (GRC).
The 'rx_application.png' file contains a screenshot of the GRC flow graph.
The 'rx_application.py' file is the python file automatically generated by GRC.

To run the receiver:
    
    $ open the 'rx_application.grc' with GRC, adapt the IP address of the USRP according to reservation 
    $ double click on the 'File Sink' to choose the location you wanna save the file
    $ execute the flow graph with the "run" button 

This .grc file mainly consists of the following components:
  * USRP source
    * Provides raw samples from the USRP
  * Multiply Const
    * Provides extra amplification if necessary 
  * FLL Band Edge
    * Implements frequency locked loop and band edge filters to correct the frequency offset
  * Correlate and Sync
    * The block searches for a preamble using correlation to get time and phase estimation
  * Poly phase clock sync
    * Performs clock correction using poly phase filter
  * CMA Equalizer
    * Compensates for non-flat frequency response of the channel, and scales the samples. 
  * Costas loop
    * Performs fine clock and phase adjustment and lock to a particular constellation  
  * Packet Decoder
    * Decode the symbols, remove preambles and headers, output payload bytes and number of packets received per second
  * File Sink
    * Stores the decoded bytes into a file 
  * QT GUI Constrellation Sink, Number Sink
    * Visualize the constellation and the packet reception rate respectively 




References:
  * http://gnuradio.org/redmine/projects/gnuradio/repository/revisions/master/show/gr-digital/examples/
  * http://gnuradio.org/redmine/projects/gnuradio/wiki/Guided_Tutorial_PSK_Demodulation
