Simple transmitter example
===================

iMinds
-----

The 'tx_application.ns' file describes the topology of the USRP and the host server on the testbed.
The 'tx_application.grc' file implements a simple transmitter in GNU Radio Companion (GRC), which reads data from the source file and feed it to a packet generator (a hierachical block), users may vary the payload size and interpacket interval at run time. 
The 'tx_application.png' file contains the screenshot of the top level GRC flow chart.
The 'crew_packet_gen.grc' is the flow chart  of the hierachical block packet generator in GRC.
The 'crew_packet_gen.png' contains the screenshot of the packet generator's flow chart.
All python files are automatically generated by the GRC.

Requirements:

  * [Install Open VPN client](https://openvpn.net/index.php/open-source/downloads.html)
  * [Request an w-iLab.t testbed account](http://ilabt.iminds.be/gettingstarted)
  * [Basic knowledge of the w-iLab.t Zwijnaarde testbed](http://ilabt.iminds.be/node/93)
  * [Basic knowledge of using USRP in w-iLab.t Zwijnaarde testbed](http://doc.ilabt.iminds.be/ilabt-documentation/wilabfacility.html#using-the-usrp-devices)

To run the transmitter:

    $ reserve 1 USRP and 1 server (can be both server1P or server5P) on the testbed reservation page
    $ define an emulab experiment using the tx_application.ns file (if it does not exist), adapt the USRP and server in the ns file according to the reservation, and swap in the experiment
    $ log onto the reserved server with your w-iLab.t account graphically (with -X option if using ssh client)
    $ verify the connection between the server and USRP
    $ launch GRC by running the command: gnuradio-companion
    $ open the 'crew_packet_gen.grc' with GRC and compile it with the 'compile' button, after which you should see the 'crew' category shows up in your GRC library
    $ open the 'tx_application.grc' with GRC, adapt the IP address of the USRP according to the reservation, and execute the flow chart  with the "run" button 
    $ alternatively we can directly run the python file without using GRC to start the transmission.

This tx_application.grc file consists of five components:
  * File Source
    * Provides bits from a file
  * Packet Generator 
    * Fragments the bitstream by the payload size
    * Appends 32 bit CRC for the payload in each packet
    * Appends 32 bit header, among which 12 bit for payload length, 12 bit for sequence number and 8 bit for the CRC of the header (for details see GNURadio packet_header_default.h)  
    * Append a preamble of 64 bit
  * Multiply Const
    * Scales down the amplitude of the samples before transmitting to USRP, else DAC might be saturated
  * USRP sink
    * Sends the sample to USRP and transmits over the air
  * Frequency sink
    * Provides the spectrum view of the transmitted samples

References:
  * http://gnuradio.org/redmine/projects/gnuradio/repository/revisions/master/show/gr-digital/examples/

